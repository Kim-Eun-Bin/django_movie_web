{% extends 'movie/header.html' %}

{% block content %}
    <div class="movie-score-list">
        <div class="search">
            {% if user.is_authenticated %}
                <a href="{% url 'post_review' %}" class="add-post">Í∏ÄÏì∞Í∏∞</a>
            {% endif %}
            <input id="search_keyword" type="text" placeholder="search">
            <button id="search_btn" type="submit" class="search-btn"><img src="../../static/image/magnifying-glass.png"></button>
        </div>
        <table class="score-table">
            <thead>
                <tr>
                    <th style="width: 20%">ÏòÅÌôî</th>
                    <th style="width: 50%">Ï†úÎ™©</th>
                    <th style="width: 10%">ÏûëÏÑ±Ïûê</th>
                    <th style="width: 12%">ÏûëÏÑ±Ïùº</th>
                    <th style="width: 8%">Î≥ÑÏ†ê</th>
                </tr>
            </thead>
            <tbody>
                {% for post in post_list %}
                    <tr>
                        <td class="f-14" style="color: red">{{ post.movie_id.movie_title }}</td>
                        <td>{{ post.title }}</td>
                        <td class="f-14">{{ post.author }}</td>
                        <td class="f-14">{{ post.created_at }}</td>
                        <td>‚ù§Ô∏è‚ù§Ô∏èü§çü§çü§ç</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script>
        $(document).ready(function() {
            $('#search_btn').click(function() {
                let movie_title = $('#search_keyword').val();
                if(movie_title === "") {
                    movie_title = "all";
                }
                $('tbody').empty()
                $.ajax({
                    url: "{% url 'search_review' %}",
                    type: "post",
                    data: {
                        csrfmiddlewaretoken : '{{ csrf_token }}',
                        keyword : movie_title
                    },
                    dataType: "json",
                    success: function (data) {
                        let txt = "";
                        for(let obj of data) {
                            txt += '<tr><td class="f-14" style="color: red">' + obj['movie_title'] + '</td>';
                            txt += '<td>' + obj['title'] + '</td>';
                            txt += '<td class="f-14">' + obj['author'] + '</td>';
                            txt += '<td class="f-14">' + obj['created_at'] + '</td>';
                            txt += '<td>' + "‚ù§Ô∏è‚ù§Ô∏èü§çü§çü§ç" + '</td></tr>';
                        }
                        $('tbody').append(txt);
                    }
                })
            })
        })
    </script>
{% endblock %}

